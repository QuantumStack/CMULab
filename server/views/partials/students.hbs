<article class="message is-info">
	<div class="message-body">
		View data for students based on lab check-ins. The section listed in the table is based on recorded data. You can upload a CSV with the header <code>_id,section</code> to set student section registration.
	</div>
</article>

<form method="POST" target="_self">
	<label class="label">Upload section registration: {{> asterisk}}</label>
	<div class="field">
		<div class="control">
			<div class="file has-name">
				<label class="file-label">
					<input id="file" class="file-input" type="file" />
					<input id="csv" type="hidden" name="data" />
					<span class="file-cta">
						<span class="file-icon">
							<i class="fa fa-upload"></i>
				    	</span>
						<span class="file-label">
							Choose fileâ€¦
						</span>
					</span>
					<span id="filename" class="file-name">
						Nothing selected
					</span>
				</label>
			</div>
		</div>
	</div>
	<div class="field is-grouped">
		<div class="control">
			<button formaction="/admin/enrollstudents" type="submit" class="button is-info">
				<span class="icon">
					<i class="fa fa-box"></i>
		    	</span>
		    	<span>Submit</span>
			</button>
		</div>
		<div class="control">
			<button formaction="/admin/removestudents" type="submit" class="button is-danger">
				<span class="icon">
					<i class="fa fa-trash"></i>
		    	</span>
				<span>Delete All</span>
			</button>
		</div>
	</div>
</form>

<script>
var file = document.getElementById("file");
file.onchange = function() {
    if (file.files.length > 0) {
		document.getElementById("filename").innerHTML = file.files[0].name;

		var reader = new FileReader();
		reader.onload = (function() {
			return function(e) {
				document.getElementById("csv").value = e.target.result.trim();
			};
		})(file.files[0]);

		reader.readAsText(file.files[0]);
    }
};
</script>

<br />

<table class="table is-hoverable is-fullwidth">
	<thead>
		<tr>
			<th>Student ID</th>
			<th>Section</th>
			<th>Avg. Score</th>
		</tr>
	</thead>
	<tbody>
		{{#each students}}
			<tr>
				<td>
					{{this._id}}
				</td>
				<td>
					{{freqreduce this.section}}
				</td>
				<td>
					{{round this.avgscore}}
				</td>
			</tr>
		{{/each}}
	</tbody>
</table>
