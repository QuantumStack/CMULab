<script src="/javascripts/bulma-quickview.min.js"></script>
<script src="/javascripts/dropdown.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="/javascripts/toggle-good.js"></script>

<table class="table is-hoverable is-fullwidth">
	<thead>
		<tr>
			<th>Section</th>
			<th>Student ID</th>
			<th>Score</th>
			<th>Lab</th>
			<th>Date</th>
			<th>TA</th>
			<th>Flags</th>
		</tr>
	</thead>
	<tbody>
		{{#each entries}}
			<tr>
				<td>
					{{this.section}}
				</td>
				<td>
					{{this.student_id}}
				</td>
				<td>
					{{this.score}}
				</td>
				<td>
					{{this.lab}}
				</td>
				<td>
					{{prettyDate this.date}}
				</td>
				<td>
					{{this.ta}}
				</td>
				<td>
					{{#if (isNonEmpty this.flags)}}
						<div class="dropdown is-right" id="dropdown-{{this._id}}">
							<div class="dropdown-trigger">
								<a class="tooltip" onclick="toggleDropdown('dropdown-{{this._id}}');" data-tooltip="Suspicious activity detected">
									<span class="icon has-text-danger">
										<i class="fas fa-exclamation-triangle"></i>
									</span>
								</a>
							</div>
							<div class="dropdown-menu">
								<div class="dropdown-content">
									{{#if this.flags.ghost}}
										<div class="dropdown-item">
											<p>
												<span class="icon is-small has-text-info">
													<i class="fas fa-ghost"></i>
												</span>
												Not registered for course at check-in.
											</p>
										</div>
										<hr class="dropdown-divider">
									{{/if}}
									{{#if this.flags.attempt}}
										<div class="dropdown-item">
											<p>
												<span class="icon is-small has-text-info">
													<i class="fas fa-redo"></i>
												</span>
												Student was checked in {{prettyDiff this.flags.attempt.diff}} prior{{#if this.flags.attempt.section}} to section {{this.flags.attempt.section}}{{/if}} for {{this.flags.attempt.score}} points.
											</p>
										</div>
										<hr class="dropdown-divider">
									{{/if}}
									{{#if this.flags.section}}
										<div class="dropdown-item">
											<p>
												<span class="icon is-small has-text-info">
													<i class="fas fa-clock"></i>
												</span>
												Wrong section time.
											</p>
										</div>
										<hr class="dropdown-divider">
									{{/if}}
									<div class="dropdown-item">
										{{#if (or this.flags.ghost this.flags.attempts)}}
											<p class="help">
												<span class="icon is-small has-text-link">
													<i class="fas fa-lightbulb"></i>
												</span>
												 Go to the <a href="/admin/students">students page</a> to update student registration data.
											</p>
										{{/if}}
										{{#if (or this.flags.attempts this.flags.section)}}
											<p class="help">
												<span class="icon is-small has-text-link">
													<i class="fas fa-lightbulb"></i>
												</span>
												Update section and time slot data <a href="/admin/settings">in settings</a>.
											</p>
										{{/if}}
									</div>
									<hr class="dropdown-divider">
									<span id="{{this._id}}-good" class="is-hidden">{{this.good}}</span>
									<a onclick="toggleGood('{{this._id}}');" class="dropdown-item">
										<span class="icon is-small has-text-primary">
											<i class="fas fa-gavel"></i>
										</span>
										Mark as <strong><span id="{{this._id}}-valid" class="has-text-{{#if this.good}}danger{{else}}success{{/if}}">{{#if this.good}}in{{/if}}valid</span></strong><span id="{{this._id}}-anyway" class="{{#if this.good}}is-hidden{{/if}}"> anyway</span>
									</a>
								</div>
							</div>
						</div>
					{{/if}}
					<span id="{{this._id}}-check" class="icon has-text-success tooltip {{#unless this.good}}is-hidden{{/unless}}" data-tooltip="{{#if (isNonEmpty this.flags)}}Marked as valid{{else}}Everything checks out!{{/if}}">
						<i class="fas fa-check"></i>
					</span>
				</td>
			</tr>
		{{/each}}
	</tbody>
</table>

<a href="/admin/data" class="button is-small is-outlined is-dark is-overlay">
	<span class="icon">
		<i class="fas fa-chevron-left"></i>
	</span>
	<span>Back</span>
</a>
&nbsp;
<span>
	Total entries: <strong>{{entries.length}}</strong>
</span>
